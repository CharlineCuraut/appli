{"ast":null,"code":"var _jsxFileName = \"/Users/charlinecuraut/Documents/VSCode/webL3/appli/client/src/messages/ListeMessages.js\";\nimport React, { Component } from \"react\";\nimport Message from './Message';\nimport NvMessage from './NvMessage';\nimport { IdContext } from \"../context/id_context\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass ListeMessages extends Component {\n  constructor(props) {\n    super(props);\n    this.ajoutMessage = this.ajoutMessage.bind(this);\n    this.recupereLogin = this.recupereLogin.bind(this);\n    this.recupereMessages = this.recupereMessages.bind(this);\n    this.delMess = this.delMess.bind(this);\n    this.moreMessages = this.moreMessages.bind(this);\n    this.state = {\n      profil: \"\",\n      nbMessAffich: 10,\n      listeMess: []\n    };\n  }\n\n  async recupereLogin() {\n    console.log(\"appel de recupereLogin()\");\n    let t = this.context;\n    let id = t.id;\n    await axios.get(`http://localhost:4000/api/user/${id}`).then(res => {\n      this.setState({\n        profil: res.data['user']['login'],\n        nbMessAffich: this.state.nbMessAffich,\n        listeMess: this.state.listeMess\n      });\n      console.log(\"recupereLogin() : profil=\" + this.state.profil);\n    }).catch(e => {\n      console.log(\"erreur getLogin ListeMessages\");\n    });\n  }\n\n  async recupereMessages() {\n    // console.log(\"nbAffichage = \" + nbAffichage);\n    console.log(\"appel recupereMessages\");\n    var nbAffichage = this.state.nbMessAffich;\n    await axios.get(`http://localhost:4000/apimessages/messages/getNMessages/${nbAffichage}`).then(res => {\n      this.setState({\n        profil: this.state.profil,\n        nbMessAffich: this.state.nbMessAffich,\n        listeMess: res.data\n      });\n      console.log(\"longueur liste de messages : \" + this.state.listeMess.length);\n    }).catch(e => {\n      console.log({\n        error: e.response.data.message\n      });\n    });\n  }\n\n  async ajoutMessage(msg) {\n    let t = this.context;\n    let idUser = t.id;\n    await axios.post(`http://localhost:4000/apimessages/user/${idUser}/messages`, {\n      message: msg\n    }).then(res => {\n      console.log(\"j'ai rajouté le message dans le db !\");\n      this.props.recupereNbMess();\n      this.setState({\n        profil: \"\",\n        nbMessAffich: this.state.nbMessAffich,\n        listeMess: []\n      });\n    }).catch(e => {\n      console.log({\n        error: e.response.data.message\n      });\n    });\n  }\n\n  async delMess(idMess, msg) {\n    let t = this.context;\n    let idUser = t.id;\n    console.log(\"idUser : \" + idUser + \" et idMess : \" + idMess);\n    await axios.delete(`http://localhost:4000/apimessages/user/${idUser}/messages/${idMess}`, {\n      data: {\n        message: msg\n      }\n    }).then(res => {\n      console.log(res.data['message']);\n      this.props.recupereNbMess();\n      this.setState({\n        profil: \"\",\n        nbMessAffich: this.state.nbMessAffich,\n        listeMess: []\n      });\n    }).catch(e => {\n      console.log({\n        error: e.response.data.message\n      });\n    });\n  }\n\n  moreMessages() {\n    this.setState({\n      profil: \"\",\n      nbMessAffich: this.state.nbMessAffich + 10,\n      listeMess: []\n    });\n  }\n\n  render() {\n    if (this.state.profil === \"\") this.recupereLogin();\n    if (this.state.listeMess.length === 0) this.recupereMessages();\n    console.log(\"longueur liste de messages : \" + this.state.listeMess.length);\n    var diff = this.props.nbMessTotal - this.state.nbMessAffich; // console.log(\"diff = \" + diff)\n\n    var more = diff > 0 ? /*#__PURE__*/_jsxDEV(\"i\", {\n      onClick: this.moreMessages,\n      className: \"fa-solid fa-angle-down\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 33\n    }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"sorry, no more messages ! You can write one on your own too complete the list ;)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 106\n    }, this);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages\",\n      children: [/*#__PURE__*/_jsxDEV(NvMessage, {\n        ajoutMessage: this.ajoutMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"titreAndRefresh\",\n        children: /*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Liste de Messages\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"liste_messages\",\n        children: this.state.listeMess.map((mess, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"li\", {\n            children: /*#__PURE__*/_jsxDEV(Message, {\n              changePage: this.props.changePage,\n              isUtilisateur: mess.loginUser === this.state.profil,\n              delMess: this.delMess,\n              idUser: mess.idUser,\n              idMessage: mess._id,\n              pseudo: mess.loginUser,\n              date: mess.date,\n              message: mess.message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 114,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 29\n          }, this)\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 25\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 17\n      }, this), more, /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"  \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nListeMessages.contextType = IdContext;\nexport default ListeMessages;","map":{"version":3,"sources":["/Users/charlinecuraut/Documents/VSCode/webL3/appli/client/src/messages/ListeMessages.js"],"names":["React","Component","Message","NvMessage","IdContext","axios","ListeMessages","constructor","props","ajoutMessage","bind","recupereLogin","recupereMessages","delMess","moreMessages","state","profil","nbMessAffich","listeMess","console","log","t","context","id","get","then","res","setState","data","catch","e","nbAffichage","length","error","response","message","msg","idUser","post","recupereNbMess","idMess","delete","render","diff","nbMessTotal","more","map","mess","index","changePage","loginUser","_id","date","contextType"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport Message from './Message'\nimport NvMessage from './NvMessage'\nimport { IdContext } from \"../context/id_context\";\nimport axios from \"axios\";\n\nclass ListeMessages extends Component{\n    constructor(props){\n        super(props)\n        this.ajoutMessage = this.ajoutMessage.bind(this);\n        this.recupereLogin = this.recupereLogin.bind(this); \n        this.recupereMessages = this.recupereMessages.bind(this);\n        this.delMess = this.delMess.bind(this)\n        this.moreMessages = this.moreMessages.bind(this)\n        this.state = {\n            profil : \"\",\n            nbMessAffich: 10,\n            listeMess : []\n        }\n    }\n\n    async recupereLogin() {\n        console.log(\"appel de recupereLogin()\")\n        let t = this.context;\n        let id = t.id;\n        await axios.get(`http://localhost:4000/api/user/${id}`)\n        .then((res) => {\n            this.setState({\n                profil : res.data['user']['login'],\n                nbMessAffich: this.state.nbMessAffich,\n                listeMess : this.state.listeMess\n            });\n            console.log(\"recupereLogin() : profil=\" + this.state.profil);\n        })\n        .catch(e => {console.log(\"erreur getLogin ListeMessages\")})\n    }\n\n    async recupereMessages() {\n        // console.log(\"nbAffichage = \" + nbAffichage);\n        console.log(\"appel recupereMessages\");\n        var nbAffichage = this.state.nbMessAffich;\n        await axios.get(`http://localhost:4000/apimessages/messages/getNMessages/${nbAffichage}`)\n            .then((res) => {\n                this.setState({\n                    profil : this.state.profil,\n                    nbMessAffich: this.state.nbMessAffich,\n                    listeMess : res.data\n                })\n                console.log(\"longueur liste de messages : \" + this.state.listeMess.length);\n            })\n            .catch(e => {console.log({error:e.response.data.message})})\n    }\n\n    async ajoutMessage(msg) {\n        let t = this.context;\n        let idUser = t.id;\n        await axios.post(`http://localhost:4000/apimessages/user/${idUser}/messages`, {message: msg})\n        .then((res) => {\n            console.log(\"j'ai rajouté le message dans le db !\");\n            this.props.recupereNbMess();\n            this.setState({\n                profil : \"\",\n                nbMessAffich: this.state.nbMessAffich,\n                listeMess : []\n            })\n        })\n        .catch(e => {console.log({error:e.response.data.message})})\n    }\n\n    async delMess(idMess, msg) {\n        let t = this.context;\n        let idUser = t.id;\n        console.log(\"idUser : \" + idUser + \" et idMess : \" + idMess);\n        await axios.delete(`http://localhost:4000/apimessages/user/${idUser}/messages/${idMess}`, {data: {message: msg}})\n        .then((res) => {\n            console.log(res.data['message']);\n            this.props.recupereNbMess();\n            this.setState({\n                profil : \"\",\n                nbMessAffich: this.state.nbMessAffich,\n                listeMess : []\n            })\n        })\n        .catch(e => {console.log({error:e.response.data.message})})\n    }\n\n    moreMessages() {\n        this.setState({\n            profil : \"\",\n            nbMessAffich: this.state.nbMessAffich + 10,\n            listeMess : []\n        })\n    }\n\n\n    render() {\n        if (this.state.profil === \"\") this.recupereLogin();\n        if (this.state.listeMess.length === 0) this.recupereMessages();\n        console.log(\"longueur liste de messages : \" + this.state.listeMess.length);\n        var diff = this.props.nbMessTotal - this.state.nbMessAffich\n        // console.log(\"diff = \" + diff)\n        var more = (diff > 0) ? <i onClick={this.moreMessages} className=\"fa-solid fa-angle-down\"></i> : <p>sorry, no more messages ! You can write one on your own too complete the list ;)</p>\n\n        return(\n            <div className=\"messages\">\n                <NvMessage ajoutMessage={this.ajoutMessage} />\n                <div className=\"titreAndRefresh\">\n                    <h3>Liste de Messages</h3>\n                </div>\n                <ul className=\"liste_messages\">\n                    {this.state.listeMess.map((mess, index) => (\n                        <div key={index}>\n                            <li>\n                                <Message \n                                    changePage={this.props.changePage} \n                                    isUtilisateur={mess.loginUser===this.state.profil} \n                                    delMess={this.delMess}\n                                    idUser={mess.idUser}\n                                    idMessage={mess._id}\n                                    pseudo={mess.loginUser}\n                                    date={mess.date}\n                                    message={mess.message}  \n                                />\n                            </li>\n                        </div>\n                    ))}\n                </ul>\n                {more}\n                <p>  </p>\n            </div>\n        )\n    }\n}\nListeMessages.contextType = IdContext;\n\nexport default ListeMessages"]},"metadata":{},"sourceType":"module"}